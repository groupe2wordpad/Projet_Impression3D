<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="/static/manifest.json">
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon" />
  <title>Mus√©e N'Botumbo</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background-color: #f8f5f0;
      font-family: 'Verdana', Tahoma, Geneva, sans-serif;
      overflow-x: hidden;
    }

    .page {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1s ease;
    }
    .page.active {
      opacity: 1;
      pointer-events: auto;
    }

    .container {
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      width: 100%;
      height: 100%;
      padding: 40px;
      text-align: center;
      position: relative;
    }

    #typewriter {
      font-size: 2em;
      font-weight: bold;
      font-family: 'Courier New', monospace;
      letter-spacing: 3px;
      color: #4b2e15;
      position: absolute;
      bottom: 20px;
      z-index: 10;
    }

    #glb-viewer {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    /* Le reste des styles (page interaction, carrousel, responsive, etc.) est inchang√© */

    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      max-width: 1000px;
      margin: 40px auto auto 0em;
      gap: 40px;
      padding: 0 20px;
    }

    .img-left, .img-right {
      width: 2%;
      height: 2%;
      object-fit: contain;
      animation-duration: 6s;
      animation-iteration-count: infinite;
      animation-timing-function: linear;
    }

    .img-left { animation-name: flip-left; }
    .img-right { animation-name: flip-right; }

    @keyframes flip-left {
      0% { transform: rotateY(0); }
      50% { transform: rotateY(180deg); }
      100% { transform: rotateY(360deg); }
    }

    @keyframes flip-right {
      0% { transform: rotateY(0); }
      50% { transform: rotateY(-180deg); }
      100% { transform: rotateY(-360deg); }
    }

    #animated-text {
      font-family: 'Courier New', monospace;
      letter-spacing: 1.1px;
      font-weight: bold;
      margin-top: 3em;
      color: #F77F00;
      font-size: 1.6rem;
      text-align: center;
      flex-grow: 1;
    }

    textarea {
      width: 90%;
      max-width: 800px;
      min-height: 200px;
      margin: 10em auto 1em 1.6em;
      font-size: 1.1rem;
      padding: 10px;
      border: 2px solid #4b2e15;
      border-radius: 6px;
      resize: vertical;
      color: #F77F00;
    }

    #send-button {
      display: block;
      margin: 4em auto 50px 17.3em;
      font-weight: bold;
      padding: 10px 20px;
      font-size: 1.3rem;
      width: 10em;
      background-color: #F77F00;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #send-button:hover {
      background-color: #cc6500;
    }

    .carousel-fade {
      width: 90%;
      max-width: 800px;
      height: 400px;
      position: relative;
      overflow: hidden;
      border-radius: 10px;
    }

    .carousel-fade img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: contain;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }

    .carousel-fade img.active {
      opacity: 1;
      z-index: 1;
    }
  </style>

  <!-- Import Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.134.0/examples/js/controls/OrbitControls.js"></script>
</head>

<body>
  <!-- PAGE 1 : Remplac√©e par GLB Viewer -->
  <div id="page-repos" class="page active">
    <div class="container">
      <div id="glb-viewer"></div>
      <h1 id="typewriter"></h1>
    </div>
  </div>

  <!-- PAGE 2 : Interaction -->
  <div id="page-interaction" class="page">
    <header>
      <img src="static/img/aboya_img.jpg" class="img-left" />
      <div id="animated-text"></div>
      <img src="static/img/aboya_img.jpg" class="img-right" />
    </header>
    <textarea placeholder="Tu peux √©crire ta question ici..............."></textarea>
    <button id="send-button">Envoyer</button>
  </div>

  <!-- PAGE 3 : Carrousel -->
  <div id="page-pagne" class="page">
    <div id="cadre_medias">
      <div class="carousel-fade">
        <img src="/static/img/pagne1.jpg" class="slide active" />
        <img src="/static/img/pagne2.png" class="slide" />
        <img src="/static/img/pagne3.jpg" class="slide" />
      </div>
    </div>
  </div>

  <!-- Script principal -->
  <script>
    // Typewriter
    const typewriterEl = document.getElementById("typewriter");
    const textRepos = "N'BOTUMBO INTERFACE";
    async function typeWriterRepos() {
      while (true) {
        typewriterEl.innerHTML = "";
        for (let i = 0; i < textRepos.length; i++) {
          typewriterEl.innerHTML += textRepos.charAt(i);
          await new Promise(r => setTimeout(r, 150));
        }
        await new Promise(r => setTimeout(r, 2000));
      }
    }

    const animatedTextEl = document.getElementById("animated-text");
    const textInteraction = "Que souhaites-tu savoir sur moi ou sur la culture baoul√© ?";
    async function typeWriterInteraction() {
      while (true) {
        animatedTextEl.innerHTML = "";
        for (let i = 0; i < textInteraction.length; i++) {
          animatedTextEl.innerHTML += textInteraction.charAt(i);
          await new Promise(r => setTimeout(r, 200));
        }
        await new Promise(r => setTimeout(r, 1500));
      }
    }

    function enableTextareaAutoResize() {
      const textarea = document.querySelector('textarea');
      const adjustHeight = () => {
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
      };
      textarea.addEventListener('input', adjustHeight);
      adjustHeight();
    }

    setTimeout(() => {
      document.getElementById("page-repos").classList.remove("active");
      document.getElementById("page-interaction").classList.add("active");
      typeWriterInteraction();
      enableTextareaAutoResize();
    }, 200000);

    window.onload = () => {
      typeWriterRepos();
      initGLBViewer();  // Ajoute le viewer 3D au chargement
    };

    const textarea = document.querySelector("textarea");
    const sendButton = document.getElementById("send-button");

    function handleUserMessage() {
      const message = textarea.value.toLowerCase();
      if (message.includes("pagne")) {
        document.getElementById("page-interaction").classList.remove("active");
        document.getElementById("page-pagne").classList.add("active");
      }
    }

    sendButton.addEventListener("click", handleUserMessage);

    // Carrousel
    const slides = document.querySelectorAll(".carousel-fade img");
    let currentSlide = 0;
    setInterval(() => {
      slides[currentSlide].classList.remove("active");
      currentSlide = (currentSlide + 1) % slides.length;
      slides[currentSlide].classList.add("active");
    }, 3000);

    // THREE.JS GLB Viewer
    

      function initGLBViewer() {
  const container = document.getElementById('glb-viewer');
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
  const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
  renderer.setSize(container.clientWidth, container.clientHeight);
  container.appendChild(renderer.domElement);

  const light = new THREE.HemisphereLight(0xffffff, 0x444444, 2);
  scene.add(light);

  const ambient = new THREE.AmbientLight(0xffffff, 2);
  scene.add(ambient);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.05;
  controls.autoRotate = true;
  controls.autoRotateSpeed = 2.0;

  camera.position.set(70, -10,0);
  controls.update();

  // ‚úÖ D√©clare ici ton GLTFLoader
  const loader = new THREE.GLTFLoader();

  loader.load('/static/models/Statuette3D.glb', function(gltf) {
    // üî∂ Appliquer couleur orange
    gltf.scene.traverse((child) => {
      if (child.isMesh) {
        child.material = new THREE.MeshStandardMaterial({
          color: 0xF77F00, // orange
          metalness: 0.3,
          roughness: 0.6
        });
      }
    });

    scene.add(gltf.scene);
    animate();
  }, undefined, function(error) {
    console.error('Erreur de chargement GLB :', error);
  });

  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  }

  window.addEventListener('resize', () => {
    camera.aspect = container.clientWidth / container.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container.clientWidth, container.clientHeight);
  });
}

  </script>
</body>
</html>
